<h2 class='show_title'><%= @video.name %></h2>
<%= video_tag @video.path, size: "854x480", controls: true, id: 'video', class: 'video-player' %>
<div id="video_description"><%= @video.description %></div>

<%# Only supervisors and the executive can add custom thumbnails %>
<% if current_user.user_level_id == SUPERVISOR_VALUE || current_user.user_level_id == EXECUTIVE_VALUE %>
<h2>Create custom thumbnail</h2>

<button id="capture">
  capture
</button>

<canvas id="canvas" class='hidden'></canvas>
<img id='video_image' style="width:426px; height:240px; border:2px solid black;" src="" />
<% end %>
<%= form_for @video do |f| %>
  <%= hidden_field(:video, :image_id, value: current_user.id) %>
<% end %>
<script>
  function thumbnail(){
    var canvas = document.getElementById('canvas');
    var video = document.getElementById('video');
    canvas.height = 240;
    canvas.width = 426;
    canvas.getContext('2d').drawImage(video, 0, 0, 426, 240);
  }
  document.getElementById('capture').addEventListener('click', function(){
    thumbnail();	
    addImg();
  });

  // document.getElementById('video_thumbnail_upload').addEventListener('click', function(){
  //   var canvas = document.getElementById('canvas');
  //   var dataUrl = canvas.toDataURL("image/jpeg");
  //   var dataImg = document.createElement('img');
  //   dataImg.src = dataUrl;
  // });

  function addImg() {
    var canvas = document.getElementById('canvas');

    canvas.toBlob(function(blob) {
      var img = document.getElementById('video_image'),
          url = URL.createObjectURL(blob),
          div = document.getElementsByClassName('middle_content')[0];

      img.onload = function() {
        // no longer need to read the blob so it's revoked
        URL.revokeObjectURL(url);
      };

      img.src = url;
    });
  }
</script>