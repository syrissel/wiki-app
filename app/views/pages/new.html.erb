<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<h1 class="edit_title edit_font">New Wiki</h1>

<%#= render plain: params[:page].inspect %>
<%#= @page.errors[:title] if @page.present? %>

<div class="errors">
<% if @page.present? && @page.errors.any? %>
	<p><%= pluralize(@page.errors.count, "error") %> prevented this wiki from being saved:</p>
	<ul>
	<% @page.errors.full_messages.each do |msg| %>
		<li><%= msg %></li>
	<% end %>
	</ul>
<% end %>
</div>

<%= form_for @page, url: pages_path, html: { id: 'page_form' }, validate: true do |f| %>
  <div class="form_group">
    <%= f.label :title, class: "form_label" %><br>
    <%= f.text_field :title, class: "text_field" %>
		<div class="errors" id="title_error"></div>
  </div>
  <div class="form_group">
    <%= hidden_field(:page, :user_id, value: current_user.id) %>
    <%= hidden_field(:page, :approval_status_id, value: PENDING) %>
		<%= hidden_field(:page, :last_user_edit, value: current_user.username) %>
		<%= hidden_field(:page, :page_publish_status_id, value: UNPUBLISHED) %>
  </div>
	<div class="form_group">
		<%= f.label 'Give a quick summary of what this wiki is about', class: 'form_label' %>
		<%= f.text_field :description, class: "text_field"%>
		</div>
	<div class="form_label form_group">
    <%= f.label :category %><br />
		<%#= collection_select :page, :category_id, Category.order(:id).where('category_id IS NULL'), :id, :name, {prompt: true}, {id: 'root'} %>
	
	<button type="button" class="show-category-options">Select Category</button>
	<div class="category_select hidden">
		<div class="image_options_header">
			<h2>Choose Category</h2>
			<button type='button' class="show-category-options">x</button>
		</div>
		<%= render 'category_select' %>
		<button type='button' class="show-category-options" style="float:right;">OK</button>
	</div>
	</div>
	<div class="errors" id="category_error"></div>

  <div class="form_group">
    <%#= f.label :content, class: "form_label" %>
      <div class="form-group">
      <%= f.hidden_field :content, :id => "post-content", required: true %>
      <div id="editor-container" hidden="true"></div>
      <div id="toolbar">
			<span class="ql-formats">
				<select class="ql-font">
					<option selected></option>
					<option value="serif"></option>
					<option value="monospace"></option>
				</select>
			</span>
			<span class="ql-formats">
				<select class="ql-size">
					<option value="small"></option>
					<option selected></option>
					<option value="large"></option>
					<option value="huge"></option>
				</select>
			</span>
			<span class="ql-formats">
				<button class="ql-header" value="1"></button>
				<button class="ql-header" value="2"></button>
				<button class="ql-blockquote"></button>
				<button class="ql-code-block"></button>
				<button class="ql-hr"><b>â€”</b></button>
				<%#<button class="ql-border"><b>BR</b></button>%>
			</span>
			<span class="ql-formats">
				<button class="ql-bold"></button>
				<button class="ql-italic"></button>
				<button class="ql-underline"></button>
				<button class="ql-strike"></button>
			</span>
			<span class="ql-formats">
				<button class="ql-list" value="ordered"></button>
				<button class="ql-list" value="bullet"></button>
				<button class="ql-indent" value="-1"></button>
				<button class="ql-indent" value="+1"></button>
			</span>
			<span class="ql-formats">
				<select class="ql-color">
				</select>
				<select class="ql-background">
				</select>
			</span>
			<span class="ql-formats">
				<button class="ql-link"></button>
				<button class="show-image-options" type='button'><box-icon size="16" type='solid' name='image-alt'></box-icon></button>
				<button class="custom_video_button show-video-options" type='button'><box-icon size="16" name='video' type='solid' ></box-icon></button>
			</span>
			<span class="ql-formats">
				<button class="ql-clean"></button>
			</span>
			<span class="ql-formats">
				<button class="ql-align" value=""></button>
				<button class="ql-align" value="center"></button>
				<button class="ql-align" value="right"></button>
				<button class="ql-align" value="justify"></button>
			</span>
		</div>
      <div id="editor"></div>
    </div>
  </div>
	<div class="form_aside">
		<div class="form_group">
			<%= f.label "Wiki photo (optional)"%>
			<%= f.file_field :image, id: 'preview_upload' %>
			<img id="img_prev" src="#", class="hidden" style="width:20%; height:20%;"/>
		</div>
	</div>
  <div class="form_group">
    <%= f.submit "Submit", class: "link_button", data: { confirm: "Submit wiki?" } %>
  </div>
<% end %>
<div class="image_options hidden clearfix">
	<div class="image_options_header">
		<h2>Insert Image</h2>
		<button type='button' class="show-image-options">x</button>
	</div>
	<ul>
	<div class='radio_wrapper'>
	<% if @images.present? %>
		<%= render 'image_search' %>
	<div id="paginator">
		<%= paginate @images, remote: true %>
	</div>
		<div class="media_options_wrapper">
		<button type='button' id="image_button">Insert</button>
		<button type='button' class="show-image-options">Cancel</button>
	</div>
	<% end %>
	</div>
	</ul>
</div>

	<div class="video_options hidden clearfix">
	<h2>Insert Video</h2>
	<ul>
	<div class='radio_wrapper'>
	<% if @videos.present? %>
	<% @videos.each do |v| %>
	<li>
	
	<div class='radio_top'>
	<strong><%= v.name %></strong>
	</div>
	<%# Store video path in data for retrieval by jquery %>
	<div class='radio_bottom'>
	
	<label>
	
	<%= content_tag :input, type: 'radio', name: 'video', data: {video: Video.find(v.id).path, thumbnail: Video.find(v.id).image.video_path.url} do %>
	<% if v.image.video_path.present? %>
		<%# <div class="video_image_wrapper"> %>
		<%= image_tag(v.image.video_path.url, size: '196x111') %>
		<%# <box-icon class="video_preview_icon" size="96px" color="#656565" name='play'></box-icon>
		</div> %>
	<% elsif v.image.path.present? %>
		<%= image_tag(v.image.path.url, size: '196x111') %>
	<% end %>
	<%# '295.783x166.367' %>
	</label>
	<% end %>
	</div>
	</li>
	<% end %>
	<%= paginate @videos, params: { video: true } %>
		<div class="media_options_wrapper">
		<button type='button' id="video_button">Insert</button>
		<button type='button' class="show-video-options">Cancel</button>
		<%= link_to 'Upload', new_video_path %>
	</div>
	<% end %>
	</div>
	</ul>
</div>
